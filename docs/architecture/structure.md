# Project Structure for `promptman`

This document outlines the project structure and organization patterns used in promptman as a specialized prompt engineering agent.

## Principles

* **Prompt Engineering Focus** – Specialize in analyzing, synthesizing, and maintaining prompt engineering knowledge and best practices.
* **Contextor Integration** – Use Contextor to manage content fetching and maintain a `_context/` directory with MCP files.
* **Single Agent, Multiple Roles** – One agent with specialized roles for analysis, synthesis, and template maintenance.
* **Change Detection & Analysis** – Detect meaningful changes in prompt engineering guidance and synthesize insights.
* **Template & Best Practice Curation** – Maintain high-quality, curated templates and guidelines.
* **Conservative Updates with Citations** – Propose documentation changes via PRs with clear rationale and sources.
* **MkDocs Material, minimal plugins** – Clean, accessible documentation site.

---

## Proposed Project Structure

```sh
promptman/
├─ config/
│  ├─ targets.yaml              # Contextor configuration for AI/LLM sites
│  ├─ analysis.yaml             # Prompt engineering analysis rules
│  ├─ templates.yaml            # Template generation configuration
│  └─ synthesis.yaml            # Insight synthesis rules
│
├─ _context/                    # Generated by Contextor (MCP files)
│
├─ analysis/
│  └─ {yyyy-mm-dd}/
│     ├─ changes.md             # Detected changes in prompt engineering guidance
│     ├─ insights.md            # Synthesized insights and patterns
│     └─ recommendations.md     # Actionable recommendations
│
├─ docs/
│  ├─ index.md
│  ├─ core/                     # Prompt engineering principles and best practices
│  │  ├─ principles.md
│  │  ├─ system-prompts.md
│  │  ├─ few-shot-examples.md
│  │  ├─ chain-of-thought.md
│  │  └─ evaluation-methods.md
│  ├─ templates/                # Curated prompt templates
│  │  ├─ reasoning.md
│  │  ├─ creative-writing.md
│  │  ├─ code-generation.md
│  │  ├─ analysis.md
│  │  └─ classification.md
│  ├─ techniques/               # Advanced techniques and patterns
│  │  ├─ structured-output.md
│  │  ├─ role-playing.md
│  │  ├─ multi-step-reasoning.md
│  │  └─ error-correction.md
│  └─ insights/                 # Weekly insights and trend analysis
│
├─ promptman/
│  ├─ __main__.py               # CLI: `promptman <command>`
│  ├─ core/
│  │  ├─ config.py              # Configuration management
│  │  ├─ models.py              # Data models for analysis
│  │  └─ mcp_reader.py          # MCP file processing
│  ├─ analyzers/
│  │  ├─ change_detector.py     # Detect changes in prompt engineering content
│  │  ├─ pattern_extractor.py   # Extract patterns and techniques
│  │  └─ quality_assessor.py    # Assess content quality and relevance
│  ├─ synthesizers/
│  │  ├─ insight_generator.py   # Generate insights from changes
│  │  ├─ trend_analyzer.py      # Analyze trends over time
│  │  └─ recommendation_engine.py # Generate actionable recommendations
│  ├─ writers/
│  │  ├─ template_writer.py     # Update prompt templates
│  │  ├─ docs_writer.py         # Update core documentation
│  │  └─ insight_writer.py      # Generate insight summaries
│  ├─ tools/
│  │  ├─ llm.py                 # LLM integration for analysis
│  │  ├─ embedding.py           # Embedding-based similarity analysis
│  │  └─ validation.py          # Template and content validation
│  └─ utils/
│     ├─ prompt_utils.py        # Prompt engineering utilities
│     └─ content_utils.py       # Content processing utilities
│
├─ templates/                    # Template sources and schemas
│  ├─ system-prompt-template.md
│  ├─ few-shot-template.md
│  ├─ chain-of-thought-template.md
│  └─ structured-output-template.md
│
├─ mkdocs.yml                    # Site configuration (Material theme)
├─ .github/workflows/
│  ├─ analyze.yml               # Weekly analysis workflow
│  └─ pages.yml                 # Deploy documentation site
├─ Makefile                     # Development shortcuts
└─ README.md
```

---

# Configuration Examples

## `config/targets.yaml` (Contextor configuration)

```yaml
# Contextor configuration for fetching prompt engineering content
version: "1.0"
output_dir: "_context"

sites:
  - slug: anthropic-docs
    name: "Anthropic Documentation"
    base_url: https://docs.anthropic.com
    robots_txt: true
    rate_limit:
      requests_per_second: 2
      concurrent: 3
    selector: "main article"
    pages:
      - path: /en/docs/build-with-claude/prompt-engineering/system-prompts
      - path: /en/docs/build-with-claude/prompt-engineering/be-clear-and-direct
      - path: /en/docs/build-with-claude/prompt-engineering/chain-of-thought
      - path: /en/docs/build-with-claude/prompt-engineering/few-shot-examples
    
  - slug: openai-docs
    name: "OpenAI Platform Documentation"
    base_url: https://platform.openai.com
    robots_txt: true
    rate_limit:
      requests_per_second: 1
      concurrent: 2
    selector: "article, .docs-content"
    sitemap: true
    filters:
      include_patterns:
        - "*/docs/guides/prompt-engineering*"
        - "*/docs/guides/structured-outputs*"
        - "*/docs/guides/function-calling*"
      exclude_patterns:
        - "*/api/*"
        - "*/changelog/*"
        
  - slug: mcp-spec
    name: "Model Context Protocol Specification"
    base_url: https://spec.modelcontextprotocol.io
    robots_txt: true
    selector: "main, .content"
    sitemap: true
```

## `config/analysis.yaml` (Prompt engineering analysis configuration)

```yaml
# Analysis rules for prompt engineering content
analysis:
  content_types:
    - system_prompts
    - few_shot_examples
    - chain_of_thought
    - structured_outputs
    - function_calling
    - evaluation_methods
  
  change_significance:
    breaking:
      - "deprecated"
      - "no longer supported" 
      - "removed"
      - "breaking change"
    important:
      - "new technique"
      - "best practice"
      - "improved performance"
      - "recommended approach"
    minor:
      - "example updated"
      - "clarification"
      - "typo fix"
  
  pattern_extraction:
    techniques:
      - "role definition"
      - "step-by-step reasoning"
      - "output formatting"
      - "error handling"
      - "context management"
    
  quality_metrics:
    - clarity
    - completeness
    - actionability
    - evidence_based
    - examples_provided

mapping_rules:
  - match:
      site: anthropic-docs
      topics: ["system-prompts"]
    update:
      docs: ["docs/core/system-prompts.md"]
      templates: ["templates/system-prompt-template.md"]
  
  - match:
      site: openai-docs
      topics: ["function-calling", "structured-outputs"]
    update:
      docs: ["docs/techniques/structured-output.md"]
      templates: ["templates/structured-output-template.md"]
```

---

# Promptman Roles (Prompt Engineering Focused)

* **analyzer** 

  * Process MCP files from `_context/` directory generated by Contextor.
  * Detect changes in prompt engineering content using content hashes and semantic analysis.
  * Extract prompt engineering patterns, techniques, and best practices from content.
  * Classify change significance (breaking, important, minor) using heuristics + LLM assistance.
  * Generate `analysis/{date}/changes.md` with structured change summaries.

* **synthesizer**

  * Read change analysis and extract actionable insights about prompt engineering trends.
  * Identify emerging patterns, deprecated techniques, and new best practices.
  * Generate `analysis/{date}/insights.md` with synthesized knowledge and recommendations.
  * Create trend analysis showing evolution of prompt engineering practices over time.

* **template_writer**

  * Update prompt engineering templates based on latest best practices and insights.
  * Generate new templates for emerging techniques and patterns.
  * Validate templates against quality metrics (clarity, completeness, actionability).
  * Create template variants for different use cases and domains.

* **docs_writer**

  * Update core documentation (`docs/core/*`) with new prompt engineering knowledge.
  * Incorporate insights into best practice guides with proper citations and evidence.
  * Update technique documentation (`docs/techniques/*`) with new methods and improvements.
  * Maintain consistency and quality across all documentation.

* **insight_writer**

  * Generate weekly insight summaries for `docs/insights/` with key findings and recommendations.
  * Create actionable guides based on analysis of industry changes and trends.
  * Propose documentation updates via PRs with clear rationale and source citations.

> Any run with **no meaningful changes** in prompt engineering content short-circuits after analyzer and logs a "no-op" status.

---

# GitHub Actions (lean)

## `.github/workflows/analyze.yml`

```yaml
name: analyze-prompt-engineering
on:
  schedule: [{ cron: "0 2 * * 1" }]  # Mondays 02:00 UTC
  workflow_dispatch: {}
jobs:
  analyze:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - uses: actions/checkout@v4
        with: { fetch-depth: 2 }    # need HEAD^ for change detection
      
      - uses: actions/setup-python@v5
        with: { python-version: "3.11" }
      
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install contextor
      
      - name: Fetch latest prompt engineering content
        run: contextor fetch --config config/targets.yaml
      
      - name: Analyze changes and generate insights
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python -m promptman analyze --date $(date +%F)
          python -m promptman synthesize --date $(date +%F)
          python -m promptman update-docs --date $(date +%F)
      
      - name: Create PR with updates
        if: ${{ hashFiles('analysis/**', 'docs/**', 'templates/**') != '' }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --local user.name "Promptman Bot"
          git config --local user.email "promptman@github.actions"
          git add analysis/ docs/ templates/
          git commit -m "feat: weekly prompt engineering insights $(date +%F)" || exit 0
          gh pr create --title "Weekly Prompt Engineering Insights - $(date +%F)" \
                       --body "Automated analysis and synthesis of latest prompt engineering developments."
```

## `.github/workflows/pages.yml`

```yaml
name: pages
on:
  push:
    branches: [main]
  workflow_dispatch: {}
permissions:
  contents: read
  pages: write
  id-token: write
jobs:
  build-deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: "3.11" }
      - run: pip install mkdocs-material
      - run: mkdocs build --strict
      - uses: actions/upload-pages-artifact@v3
        with: { path: "site" }
      - id: deployment
        uses: actions/deploy-pages@v4
```

---

# MkDocs (lean)

`mkdocs.yml`

```yaml
site_name: Promptman
theme:
  name: material
nav:
  - Home: index.md
  - Core Principles: 
      - Overview: core/principles.md
      - System Prompts: core/system-prompts.md
      - Few-Shot Examples: core/few-shot-examples.md
      - Chain of Thought: core/chain-of-thought.md
      - Evaluation Methods: core/evaluation-methods.md
  - Templates:
      - Reasoning: templates/reasoning.md
      - Creative Writing: templates/creative-writing.md
      - Code Generation: templates/code-generation.md
      - Analysis: templates/analysis.md
      - Classification: templates/classification.md
  - Advanced Techniques:
      - Structured Output: techniques/structured-output.md
      - Role Playing: techniques/role-playing.md
      - Multi-step Reasoning: techniques/multi-step-reasoning.md
      - Error Correction: techniques/error-correction.md
  - Weekly Insights:
      - Latest: insights/
plugins:
  - search
markdown_extensions:
  - admonition
  - footnotes
  - toc:
      permalink: true
```

---

# Integration with Popular Libraries

* **LLM Integration:** OpenAI GPT-4, Anthropic Claude for content analysis and synthesis
* **Embeddings:** Optional vector similarity analysis for content changes using OpenAI embeddings
* **Content Processing:** Use pandas for data analysis, scikit-learn for clustering insights
* **Contextor Integration:** Seamless integration with Contextor's MCP file format

---

# Quality Guardrails

* Don't create PR if analysis shows only minor/editorial changes in prompt engineering content
* Require human review for all template and documentation updates
* Validate all generated templates against quality metrics before inclusion
* One PR per week maximum; update existing PR if workflow runs again
* CI must pass: schema validation, template validation, MkDocs build, and citation requirements

---

## Implementation Notes

* **MCP File Processing**: Read and validate MCP files from `_context/` directory 
* **Change Detection**: Use content hashes from MCP files to identify meaningful changes
* **Template Validation**: Ensure all templates include examples, clear instructions, and use cases
* **Citation Requirements**: All updates must include source URLs and evidence from MCP files
* **Local Development**: `make analyze` runs analysis locally; `make site` serves documentation
* **Quality Metrics**: Track template usage, documentation freshness, and insight actionability

---
